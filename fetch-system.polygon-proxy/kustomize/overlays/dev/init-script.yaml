apiVersion: v1
kind: ConfigMap
metadata:
  name: polygon-proxy-init-script
  namespace: fetch-system
data:
  init.sh: |
    #!/bin/sh

    gcloud config set core/project goboolean-450909

    apk add --no-cache curl

    SOCKETD_VERSION="0.5.3"  # Check latest version at https://github.com/panjf2000/socketd/releases
    curl -Lo /usr/local/bin/socketd https://github.com/panjf2000/socketd/releases/download/v${SOCKETD_VERSION}/socketd-x86_64-linux-musl
    chmod +x /usr/local/bin/socketd

    gsutil ls gs://goboolean-450909-load-test
    gsutil cp gs://goboolean-450909-load-test/output.txt /data/output.txt

    websocketd --port=8080 --static cat /data/output.txt
